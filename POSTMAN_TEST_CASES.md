# Postman Test Cases - CNS Application

## Base Configuration
- **Base URL**: `http://localhost:8080`
- **Auth**: Most endpoints require `Authorization: Bearer <JWT_TOKEN>` (See Guide for retrieval).
- **Public Endpoints**: `/api/notifications/send` and `/api/notifications/send/bulk` (Use API Key in body).

---

## 1. Authentication Scenarios

### ‚ùå Access Protected Resource Without Token
```http
GET /api/apps
```
- **Expected**: `401 Unauthorized`
- **Body**: `{"error": "Unauthorized", "message": "Full authentication is required..."}`

### ‚ùå Access Protected Resource With Invalid Token
```http
GET /api/apps
Authorization: Bearer invalid_token
```
- **Expected**: `401 Unauthorized`

---

## 2. App Management (Requires JWT)

### ‚úÖ Register App
```http
POST /api/apps/register
Authorization: Bearer <TOKEN>
{
  "name": "Production Service"
}
```
- **Expected**: `200 OK`
- **Verify**: `data.apiKey` is returned.

### ‚úÖ Archive & Unarchive App
```http
PATCH /api/apps/1/archive
Authorization: Bearer <TOKEN>
```
- **Expected**: `200 OK`

```http
PATCH /api/apps/1/unarchive
Authorization: Bearer <TOKEN>
```
- **Expected**: `200 OK`

---

## 3. Template Management (Requires JWT)

### ‚úÖ Create Template
```http
POST /api/templates/create
Authorization: Bearer <TOKEN>
{
  "appId": 1,
  "name": "OTP Template",
  "subject": "Your Code: {{otp}}",
  "htmlBody": "<p>Code: {{otp}}</p>",
  "status": "ACTIVE"
}
```
- **Expected**: `200 OK`

### ‚úÖ Paginated & Filtered List
```http
GET /api/templates?appId=1&status=ACTIVE&page=0&size=5
Authorization: Bearer <TOKEN>
```
- **Expected**: `200 OK`
- **Verify**: Correct page structure returned.

### ‚úÖ Activate/Archive Template
```http
PATCH /api/templates/1/archive
Authorization: Bearer <TOKEN>
```
- **Expected**: `200 OK`

---

## 4. Notifications (Public with API Key)

### ‚úÖ Send Single/Multiple (Common Logic)
```http
POST /api/notifications/send
{
  "apiKey": "<APP_API_KEY>",
  "templateId": 1,
  "recipient": "user@example.com",
  "placeholders": { "otp": "9999" }
}
```
- **Expected**: `200 OK`

### ‚úÖ Send Personalized Bulk
```http
POST /api/notifications/send/bulk
{
  "apiKey": "<APP_API_KEY>",
  "templateId": 1,
  "recipients": {
    "alice@example.com": { "otp": "1111" },
    "bob@example.com": { "otp": "2222" }
  }
}
```
- **Expected**: `200 OK`
- **Verify**: Multiple logs created in `/api/notifications/logs`.

---

## 5. Lifecycle Hooks

### ‚ùå Create Template for ARCHIVED App
1. Archive App 1.
2. Try creating a template for App 1.
- **Expected**: `400 Bad Request` or `InvalidOperationException`.

### ‚ùå Send Notification for ARCHIVED Template
1. Archive Template 1.
2. Try sending notification via Template 1.
- **Expected**: `400 Bad Request`.

---

**Generated by CNS Security System** üõ°Ô∏è
